import Head from 'next/head';
import { GetStaticProps } from 'next';
import { collection, getDocs } from 'firebase/firestore';

import { db } from '@/src/firebase/config';

import { ProductProps } from '@/src/@types/products';

import HomeScreen from '@/src/screens/HomeScreen';

interface ProductsProps {
    products: ProductProps[];
}

export default function Home({ products }: ProductsProps) {
    return (
        <>
            <Head>
                <title>Dusk&Dawn</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <meta
                    name="viewport"
                    content="width=device-width, initial-scale=1"
                />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <HomeScreen products={products} />
        </>
    );
}

export const getStaticProps: GetStaticProps = async () => {
    const collectionRef = collection(db, 'products');

    const querySnapshot = await getDocs(collectionRef);

    if (querySnapshot.empty) {
        return {
            props: {
                products: [],
            },
        };
    }

    const products = querySnapshot.docs.map((doc) => {
        const data = doc.data();

        return {
            ...data,
        };
    });

    return {
        props: {
            products: products,
        },
    };
};
